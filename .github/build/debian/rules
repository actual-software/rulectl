#!/usr/bin/make -f

export BAML_LOG=OFF
export RULECTL_BUILD=1
export DH_VERBOSE=1

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_build:
	# Create virtual environment and build executable
	python3 -m venv build_venv
	build_venv/bin/python -m pip install --upgrade pip wheel setuptools
	build_venv/bin/python fix_dependencies.py
	build_venv/bin/python baml_init.py
	build_venv/bin/python build.py
	# Verify the executable was created
	test -f dist/rulectl

override_dh_auto_install:
	# Install the standalone executable
	install -D -m 755 dist/rulectl $(CURDIR)/debian/rulectl/usr/bin/rulectl

override_dh_auto_clean:
	rm -rf build_venv
	rm -rf build
	rm -rf dist
	rm -rf *.egg-info
	rm -rf __pycache__
	rm -rf baml_client/__pycache__
	rm -rf rulectl/__pycache__
	dh_auto_clean